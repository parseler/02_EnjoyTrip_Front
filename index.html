<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>SSAFY TRIP</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon" />
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500&family=Inter:wght@400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />

    <!-- Template Main CSS Files -->
    <link href="assets/css/variables.css" rel="stylesheet" />
    <link href="assets/css/main.css" rel="stylesheet" />

    <script src="./assets/js/key.js"></script>
  </head>

  <body>
    <!-- ======= Header ======= -->
    <header id="header" class="header d-flex align-items-center fixed-top">
      <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
        <a href="index.html" class="logo d-flex align-items-center">
          <!-- Uncomment the line below if you also wish to use an image logo -->
          <!-- <img src="assets/img/logo.png" alt=""> -->
          <h1>SSAFY TRIP</h1>
        </a>

        <nav id="navbar" class="navbar">
          <ul>
            <li><a href="index.html">HOME</a></li>
            <li><a href="index.html">공지게시판</a></li>
            <li><a href="index.html">공유게시판</a></li>
          </ul>
        </nav>
        <!-- .navbar -->

        <div id="loginUserCheck">
          <a href="login.html" class="me-3">로그인</a>
          <a href="signup.html" class="me-3">회원가입</a>
          <a href="#" class="mx-2"><span class="bi-instagram"></span></a>
        </div>
      </div>
    </header>
    <!-- End Header -->

    <main id="main">
      <section class="single-post-content">
        <div class="container-fluid" style="padding-left: 30px; padding-right: 30px">
          <div class="row">
            <div class="col-md-11" id="main-map" data-aos="fade-up">
              <div class="alert alert-primary text-center fw-bold" role="alert">
                전국 관광지 정보
              </div>
              <!-- 관광지 검색 start -->
              <form class="d-flex" onsubmit="return false;" role="search">
                <select id="search-area" class="form-select me-2">
                  <option value="0" selected>검색 할 지역 선택</option>
                </select>
                <select id="search-content-id" class="form-select me-2">
                  <option value="0" selected>관광지 유형</option>
                  <option value="12">관광지</option>
                  <option value="14">문화시설</option>
                  <option value="15">축제공연행사</option>
                  <option value="25">여행코스</option>
                  <option value="28">레포츠</option>
                  <option value="32">숙박</option>
                  <option value="38">쇼핑</option>
                  <option value="39">음식점</option>
                </select>
                <input
                  id="search-keyword"
                  class="form-control me-2"
                  type="search"
                  placeholder="검색어"
                  aria-label="검색어"
                />
                <button
                  id="btn-search"
                  class="btn btn-outline-success"
                  type="button"
                  onclick="btnSearchSidebar()"
                >
                  검색바꿈
                </button>
              </form>
              <!-- kakao map start -->
              <div id="map" class="mt-3" style="width: 100%; height: 700px"></div>
              <!-- kakao map end -->
              <!-- 관광지 검색 end -->
            </div>
            <div class="col-md-1">
              <!-- 사이드바 열기 버튼 -->
              <button onclick="toggleSidebar()">></button>
            </div>
            <div class="col-md-3">
              <!-- ======= Sidebar ======= -->
              <div id="sidebar" style="display: none" class="aside-block">
                <div class="tab-content" id="place-info">
                  <!-- side -->
                  <div class="post-entry-1 border-bottom d-flex">
                    <div class="col-md-4">
                      <img src="./assets/image/다운로드.jfif" width="100%" />
                    </div>
                    <div class="col-md-7 ms-3">
                      <h2 class="mb-2">
                        <a href="#"
                          >How to Avoid Distraction and Stay Focused During Video Calls?</a
                        >
                      </h2>
                      <span class="author mb-3 d-block">Jenny Wilson</span>
                    </div>
                  </div>

                  <div class="post-entry-1 border-bottom d-flex">
                    <div class="col-md-4">
                      <img src="./assets/image/다운로드.jfif" width="100%" />
                    </div>
                    <div class="col-md-7 ms-3">
                      <h2 class="mb-2">
                        <a href="#"
                          >How to Avoid Distraction and Stay Focused During Video Calls?</a
                        >
                      </h2>
                      <span class="author mb-3 d-block">Jenny Wilson</span>
                    </div>
                  </div>

                  <!-- End Popular -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <!-- End #main -->

    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div class="footer-legal">
        <div class="container">
          <div class="row justify-content-between">
            <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
              <div class="copyright">
                © Copyright <strong><span>SSAFY</span></strong
                >. All Rights Reserved
              </div>
            </div>

            <div class="col-md-6">
              <div class="social-links mb-3 mb-lg-0 text-center text-md-end">
                <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
                <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
                <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
                <a href="#" class="google-plus"><i class="bi bi-skype"></i></a>
                <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <a href="#" class="scroll-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>

    <!-- 지도 JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script src="./assets/js/main.js"></script>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3243ee3e99da2b6c0d8e8ba20d19000e&libraries=services,clusterer,drawing"
    ></script>
    <script>
      // index page 로딩 후 전국의 시도 설정.
      let areaUrl =
        "https://apis.data.go.kr/B551011/KorService1/areaCode1?serviceKey=" +
        serviceKey +
        "&numOfRows=20&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json";

      // fetch(areaUrl, { method: "GET" }).then(function (response) { return response.json() }).then(function (data) { makeOption(data); });
      fetch(areaUrl, { method: "GET" })
        .then((response) => response.json())
        .then((data) => makeOption(data));

      function makeOption(data) {
        let areas = data.response.body.items.item;
        // console.log(areas);
        let sel = document.getElementById("search-area");
        areas.forEach((area) => {
          let opt = document.createElement("option");
          opt.setAttribute("value", area.code);
          opt.appendChild(document.createTextNode(area.name));

          sel.appendChild(opt);
        });
      }

      // 검색 버튼을 누르면..
      // 지역, 유형, 검색어 얻기.
      // 위 데이터를 가지고 공공데이터에 요청.
      // 받은 데이터를 이용하여 화면 구성.
      document.getElementById("btn-search").addEventListener("click", () => {
        let baseUrl = `https://apis.data.go.kr/B551011/KorService1/`;
        // let searchUrl = `https://apis.data.go.kr/B551011/KorService1/searchKeyword1?serviceKey=${serviceKey}&numOfRows=10&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json&listYN=Y&arrange=A`;
        // let searchUrl = `https://apis.data.go.kr/B551011/KorService1/areaBasedList1?serviceKey=${serviceKey}&numOfRows=10&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json&listYN=Y&arrange=A`;

        let queryString = `serviceKey=${serviceKey}&numOfRows=10&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json&listYN=Y&arrange=A`;
        let areaCode = document.getElementById("search-area").value;
        let contentTypeId = document.getElementById("search-content-id").value;
        let keyword = document.getElementById("search-keyword").value;

        if (parseInt(areaCode)) queryString += `&areaCode=${areaCode}`;
        if (parseInt(contentTypeId)) queryString += `&contentTypeId=${contentTypeId}`;
        // if (!keyword) {
        //   alert("검색어 입력 필수!!!");
        //   return;
        // } else searchUrl += `&keyword=${keyword}`;
        let service = ``;
        if (keyword) {
          service = `searchKeyword1`;
          queryString += `&keyword=${keyword}`;
        } else {
          service = `areaBasedList1`;
        }
        let searchUrl = baseUrl + service + "?" + queryString;

        fetch(searchUrl)
          .then((response) => response.json())
          .then((data) => makeList(data));
      });

      var positions = null; // marker 배열.
      var markers = []; //marker 배열
      var markeridx = 0;
      function makeList(data) {
        console.log(data);
        let trips = data.response.body.items.item;
        let tripList = ``;

        markers.forEach((marker) => {
          marker.setMap(null);
        });

        positions = [];

        trips.forEach((area) => {
          tripList += `
          <div onclick="moveCenter(${area.mapy}, ${area.mapx});" class="post-entry-1 border-bottom d-flex">
              <div class="col-md-4">
                <img src="${area.firstimage}" width="100px">
              </div>
              <div class="col-md-7 ms-1">
                <h2 class="mb-2">
                  <a href="#">
                  ${area.title}</a
                  >
                </h2>
                <span class="author mb-2 d-block">${area.addr1} ${area.addr2}</span>
              </div>
            </div>
          `;
          let markerInfo = {
            title: area.title,
            latlng: new kakao.maps.LatLng(area.mapy, area.mapx),
          };
          positions.push(markerInfo);
        });
        document.getElementById("place-info").innerHTML = tripList;
        displayMarker();
      }

      // 카카오지도
      var mapContainer = document.getElementById("map"), // 지도를 표시할 div
        mapOption = {
          center: new kakao.maps.LatLng(37.500613, 127.036431), // 지도의 중심좌표
          level: 5, // 지도의 확대 레벨
        };

      // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
      var map = new kakao.maps.Map(mapContainer, mapOption);

      function displayMarker() {
        // 마커 이미지의 이미지 주소입니다
        var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

        for (var i = 0; i < positions.length; i++) {
          // 마커 이미지의 이미지 크기 입니다
          var imageSize = new kakao.maps.Size(24, 35);

          // 마커 이미지를 생성합니다
          var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

          // 마커를 생성합니다
          var marker = new kakao.maps.Marker({
            map: map, // 마커를 표시할 지도
            position: positions[i].latlng, // 마커를 표시할 위치
            title: positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
            image: markerImage, // 마커 이미지
          });

          markers[markeridx++] = marker;
        }

        // 첫번째 검색 정보를 이용하여 지도 중심을 이동 시킵니다
        map.setCenter(positions[0].latlng);
      }

      function moveCenter(lat, lng) {
        map.setCenter(new kakao.maps.LatLng(lat, lng));
      }
    </script>
  </body>
</html>
